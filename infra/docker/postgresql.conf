# PostgreSQL Configuration for WAL Archiving and PITR
# This file contains only the settings needed for backup/PITR
# Other settings use PostgreSQL defaults

# ============================================
# WAL (Write-Ahead Log) Configuration
# ============================================

# Enable WAL archiving for Point-in-Time Recovery (PITR)
# Required: replica or logical (replica is sufficient for backups)
wal_level = replica

# Enable archive mode
archive_mode = on

# Archive command: Copy WAL files to archive directory
# %p = path of file to archive (full path)
# %f = filename of file to archive (just the filename)
# This command copies WAL files to the archive directory
archive_command = 'test ! -f /var/lib/postgresql/wal-archive/%f && cp %p /var/lib/postgresql/wal-archive/%f && chmod 600 /var/lib/postgresql/wal-archive/%f || exit 1'

# Maximum number of concurrent WAL sender processes (for pg_basebackup)
# Allows pg_basebackup to connect and stream WAL
max_wal_senders = 3

# Keep WAL files for replication/backup (helps with recovery)
# Keeps recent WAL files available even if archive is slow
wal_keep_size = 1GB

# Maximum size of WAL before forcing checkpoint
max_wal_size = 1GB
min_wal_size = 80MB

# ============================================
# Performance Settings (Optional optimizations)
# ============================================

# Checkpoint settings (affects WAL generation frequency)
checkpoint_timeout = 15min
checkpoint_completion_target = 0.9

# ============================================
# Logging (for backup monitoring)
# ============================================

# Log archive command execution (useful for debugging backup issues)
log_archive_command = on

# Log checkpoints (helps track WAL activity)
log_checkpoints = on

